<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>CyberMonitor Login</title>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Firebase Compat -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
   background:#0b1220;
   font-family:'Inter',sans-serif;
}
.card{
   background:#101a33;
   border:1px solid #1e2b4d;
   border-radius:18px;
}
</style>
</head>

<body class="flex justify-center items-center h-screen">

<div class="card p-8 w-full max-w-md">

<h1 class="text-2xl font-bold mb-6 text-white text-center">
CyberMonitor Login
</h1>

<!-- EMAIL -->
<label class="text-gray-300 block mb-1">Email</label>
<input id="email" type="email" placeholder="Enter your email"
class="w-full p-2 mb-3 rounded-lg bg-black/30 border border-gray-700 text-white">

<!-- PASSWORD -->
<label class="text-gray-300 block mb-1">Password</label>
<input id="password" type="password" placeholder="Enter password"
class="w-full p-2 mb-4 rounded-lg bg-black/30 border border-gray-700 text-white">

<!-- NORMAL LOGIN -->
<button onclick="loginUser()"
class="w-full bg-blue-600 hover:bg-blue-700 p-2 rounded-lg font-semibold text-white">
Login
</button>

<!-- GOOGLE OAUTH BUTTON – FORMAL WITH REAL GOOGLE LOGO -->
<button onclick="googleLogin()"
class="w-full bg-white hover:bg-gray-100 text-black px-3 py-2 rounded-lg font-semibold mt-3 flex items-center justify-center gap-3 border border-gray-300 shadow">

<!-- REAL GOOGLE G LOGO SVG -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="22" height="22">
<path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 6.19 30.47 4 24 4 14.62 4 6.51 9.38 2.56 17.22l7.98 6.19C12.43 15.72 17.74 9.5 24 9.5z"/>
<path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l8.3 6.46c4.84-4.47 7.52-11.06 7.52-18.61z"/>
<path fill="#FBBC05" d="M10.54 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 13.38 0 18.69 0 24s.92 10.62 2.56 14.78l7.98-6.19z"/>
<path fill="#34A853" d="M24 44.5c-6.26 0-11.57-4.22-13.46-10.09l-7.98 6.19C6.51 38.62 14.62 44 24 44c6.13 0 11.41-2.02 15.67-5.48l-8.3-6.46c-2.2 1.48-5.01 2.42-8.07 2.42z"/>
</svg>

Sign in with Google

</button>

<p onclick="forgotPass()"
class="text-center text-xs text-gray-400 mt-3 hover:underline cursor-pointer">
Forgot Password?
</p>

<p id="loginError" class="text-red-400 text-sm text-center mt-2"></p>

<p class="mt-4 text-gray-400 text-sm text-center">
Don't have an account?
<a href="register.html" class="text-blue-400 hover:underline">Register</a>
</p>

</div>

<script>
// ================= FIREBASE INIT =================
const firebaseConfig = {
  apiKey: "AIzaSyCIY6AiBsGrq7wM0BBYGW2lM_0FLWjnH0k",
  authDomain: "cybermonitor-1ab3c.firebaseapp.com",
  projectId: "cybermonitor-1ab3c",
  messagingSenderId: "569408987884",
  appId: "1:569408987884:web:0839eb7932c206fc157bc9"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db   = firebase.firestore();

// =========== SANITIZE ===========
function sanitizeEmail(em){
   return em.replace(/@/g,"_").replace(/\./g,"_");
}

// ================= EMAIL/PASS LOGIN =================
function loginUser(){

 const email = document.getElementById("email").value.trim();
 const pass  = document.getElementById("password").value;

 const err = document.getElementById("loginError");
 err.innerText="";

 if(!email || !pass){
    err.innerText="Enter email and password.";
    return;
 }

 const key = sanitizeEmail(email);

 auth.signInWithEmailAndPassword(email, pass)

   .then(()=>{

      // ⭐ store sanitized key for session
      localStorage.setItem("login_email", key);
      localStorage.setItem("is_logged_in","true");

      window.location.href="dashboard.html";
   })

   .catch(e=>{
      err.innerText=e.message;
   });
}

// ================= GOOGLE OAUTH =================
function googleLogin(){

 const err = document.getElementById("loginError");
 err.innerText="";

 const provider = new firebase.auth.GoogleAuthProvider();

 auth.signInWithPopup(provider)

   .then(result=>{

      const email = result.user.email;
      const key   = sanitizeEmail(email);

      const ref = db.collection("users").doc(key);

      // check profile
      return ref.get().then(doc=>{

         if(!doc.exists){

            // create NEW OAUTH USER PROFILE
            return ref.set({
               email: email,
               machine:"",
               is_online:false,
               last_seen:"",
               created_at:new Date().toISOString(),
               oauth:true
            })
            .then(()=> key);

         }else{
            return key;
         }

      });

   })

   .then(key=>{

      // ⭐ SAME SESSION FLOW
      localStorage.setItem("login_email", key);
      localStorage.setItem("is_logged_in","true");

      window.location.href="dashboard.html";

   })

   .catch(e=>{
      document.getElementById("loginError").innerText = e.message;
   });

}

// ================= FORGOT PASSWORD =================
function forgotPass(){

 const email = document.getElementById("email").value.trim();
 const err   = document.getElementById("loginError");

 err.innerText="";

 if(!email){
    err.innerText="Enter your email first.";
    return;
 }

 auth.sendPasswordResetEmail(email)

   .then(()=>{
      err.innerText="Reset link sent to email.";
   })

   .catch(e=>{
      err.innerText=e.message;
   });
}

</script>

</body>
</html>
