<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Cyber Monitor Dashboard</title>

<style>
body {
  background:#0b0f1a;
  color:#fff;
  font-family: Arial;
}
h2 { color:#00eaff; }

table {
  width:100%;
  border-collapse: collapse;
}
th, td {
  padding:8px;
  border-bottom:1px solid #222;
}

.low { color:#00ff9c; }
.medium { color:#ffcc00; }
.high { color:#ff4444; }
.critical { color:#ff0000; font-weight:bold; }

#logs {
  max-height:300px;
  overflow-y:auto;
  background:#05070d;
  padding:10px;
}
.log {
  font-size:14px;
  margin-bottom:6px;
}
</style>
</head>

<body>

<h2>ðŸ–¥ USB Security Monitor</h2>

<h3>Connected USB Devices</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>VID:PID</th>
<th>Status</th>
<th>Risk</th>
<th>Time</th>
</tr>
</thead>
<tbody id="usbTable"></tbody>
</table>

<h3>USB Event Timeline</h3>
<div id="logs"></div>

<script>
const UID = "MXxq4tHL35hzKi9PJytPCXWDSzn1";
const BASE = "https://cybermonitor-lab3c.web.app";

let seenLogs = new Set();

function riskClass(risk) {
  return risk.toLowerCase();
}

async function loadUSB() {
  const res = await fetch(`${BASE}/usb?uid=${UID}`);
  const data = await res.json();

  const table = document.getElementById("usbTable");
  table.innerHTML = "";

  data.devices.forEach(d => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${d.name}</td>
      <td>${d.vid_pid}</td>
      <td>${d.status}</td>
      <td class="${riskClass(d.risk)}">${d.risk}</td>
      <td>${d.time}</td>
    `;
    table.appendChild(tr);

    if (d.risk === "HIGH" || d.risk === "CRITICAL") {
      alert(`âš ï¸ ${d.risk} USB detected:\n${d.name}`);
    }
  });
}

async function loadLogs() {
  const res = await fetch(`${BASE}/logs?uid=${UID}`);
  const data = await res.json();
  const logBox = document.getElementById("logs");

  data.reverse().forEach(l => {
    const key = l.message + l.time;
    if (seenLogs.has(key)) return;

    seenLogs.add(key);
    const div = document.createElement("div");
    div.className = "log";
    div.innerHTML = `[${l.time}] <b class="${riskClass(l.risk)}">${l.risk}</b> - ${l.message}`;
    logBox.appendChild(div);
    logBox.scrollTop = logBox.scrollHeight;
  });
}

setInterval(loadUSB, 3000);
setInterval(loadLogs, 3000);
</script>

</body>
</html>
