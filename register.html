<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>CyberMonitor Register</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>

<body class="min-h-screen flex items-center justify-center bg-black">
<div class="card p-6 w-96 text-white">

<h2 class="text-xl mb-4">Register</h2>

<input id="rEmail" placeholder="Email"
       class="w-full p-2 mb-3 rounded bg-gray-900 border border-gray-700">

<input id="rMachine" placeholder="Machine Name"
       class="w-full p-2 mb-3 rounded bg-gray-900 border border-gray-700">

<button onclick="register()" class="w-full bg-purple-600 p-2 rounded">
Create Account
</button>

<p id="rErr" class="text-xs text-red-400 mt-2"></p>

</div>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyCIY6AiBsGrq7wM0BBYGW2lM_0FLWjnH0k",
  authDomain: "cybermonitor-1ab3c.firebaseapp.com",
  projectId: "cybermonitor-1ab3c",
});

const fs = firebase.firestore();

function register(){
 const em = document.getElementById("rEmail").value.trim();
 const mc = document.getElementById("rMachine").value.trim();

 const uid = em.replace(/@/g,"_").replace(/\./g,"_");

 /* SEPARATE DOCUMENT PER USER */
 fs.collection("users").doc(uid).set({
     email: em,
     machine: mc,
     is_online: true,
     last_seen: new Date().toISOString()
 }, {merge:true})
 .then(()=>{
     localStorage.setItem("cm_user_email", em);
     location.href="dashboard.html";
 })
 .catch(e=>{
     rErr.innerText=e;
 });
}
</script>

</body>
</html>
